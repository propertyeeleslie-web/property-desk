<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Property Desk</title>
<style>
body { font-family: Arial,sans-serif; background:#f3f4f6; padding:20px; }
.card { background:#fff; padding:20px; max-width:700px; margin:auto; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
h2 { text-align:center; }
input, button { width:100%; padding:10px; margin-top:10px; font-size:14px; }
button { background:#1e40af; color:#fff; border:none; border-radius:6px; cursor:pointer }
button:hover{background:#1d4ed8;}
table{width:100%; border-collapse:collapse; margin-top:20px;}
th,td{padding:8px; border-bottom:1px solid #e5e7eb;}
.error{text-align:center; color:red; margin-top:10px;}
</style>
</head>
<body>

<div class="card" id="login-card">
<h2>Property Desk Login</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<div id="error" class="error"></div>
</div>

<div class="card" id="app-card" style="display:none">
<h2>Properties</h2>
<table>
<thead>
<tr>
<th>Project</th>
<th>Unit</th>
<th>Status</th>
<th>Asking Rent</th>
<th>Owner Name</th>
<th>Owner Phone</th>
<th>Notes</th>
</tr>
</thead>
<tbody id="property-list"></tbody>
</table>
</div>

<script>
const API = "https://property-desk-rqjt.vercel.app/api";

let token="", role="";

async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const errorDiv = document.getElementById("error");
  errorDiv.innerText="";
  try{
    const res = await fetch(API+"/login", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({email,password})
    });
    const data = await res.json();
    if(data.error){ errorDiv.innerText=data.error; return;}
    token = data.token;
    role = data.role;
    document.getElementById("login-card").style.display="none";
    document.getElementById("app-card").style.display="block";
    loadProperties();
  }catch(e){
    errorDiv.innerText="Cannot connect to server";
  }
}

async function loadProperties(){
  const res = await fetch(API+"/properties", { headers:{"Authorization":"Bearer "+token}});
  const data = await res.json();
  const list = document.getElementById("property-list");
  list.innerHTML="";
  data.properties.forEach(p=>{
    const tr = document.createElement("tr");
    let bg="#bbf7d0";
    if(p.status==="Rented") bg="#fca5a5";
    if(p.status==="Expiring") bg="#fcd34d";
    tr.style.background=bg;
    tr.innerHTML=`<td>${p.project||""}</td><td>${p.unit_no||""}</td><td>${p.status||""}</td>
    <td>${p.asking_rent||""}</td>
    <td>${p.owner_name||""}</td>
    <td>${p.owner_phone||""}</td>
    <td>${p.note||""}</td>`;
    if(role!=="ADMIN"){ tr.cells[4].innerText=""; tr.cells[5].innerText=""; } 
    list.appendChild(tr);
  });
}
</script>

</body>
</html>
